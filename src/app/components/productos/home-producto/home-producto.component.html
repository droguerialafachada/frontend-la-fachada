<div class="container">
  <div class="row">
    <div class="col-12">
      <h1 class="rojo">
        Gestion de Productos
      </h1>
    </div>
    <div class="col-8 col-sm-8 col-md-9 col-lg-10 col-xl-10 col-xxl-10">
      <div class="buscar">
        <input type="text" id="buscar" (keyup)="buscar($event)" placeholder="  Escanear o escribir c√≥digo">
      </div>
    </div>
    <div class="col-4 col-sm-4 col-md-3 col-lg-2 col-xl-2 col-xxl-2">
      <button id="nuevo" class="btn btn-primary" routerLink="/app/producto/nuevo">Nuevo</button>
    </div>
  </div>

  <h6 class="totalProductos">Se han encontrado {{ totalProductos }} productos.</h6>

  <div class="table-container">
    <div class="separador">
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Nombre</th>
              <th class="d-none d-md-table-cell">FechaCreacion</th>
              <th class="eliminar">Acciones</th>
            </tr>
          </thead>


          <tbody>
            <!-- <tr *ngFor="let persona of personas"> -->
            <tr *ngFor="let producto of filtroProductos; let i=index">
              <td>{{ producto.codigo }}</td>
              <td>{{ producto.nombre }}</td>
              <td class="d-none d-md-table-cell">{{ producto.fechaCreacion | date }}</td>
              <td class="eliminar">
                <button class="editar" (click)="abrirModal(producto.codigo)">üëÅÔ∏è</button>
                <button class="editar red-x" (click)="eliminarProductoCodigo(producto.codigo)">
                  <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 48 48">
                    <path fill="#f44336"
                      d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"></path>
                    <path fill="#fff" d="M29.656,15.516l2.828,2.828l-14.14,14.14l-2.828-2.828L29.656,15.516z"></path>
                    <path fill="#fff" d="M32.484,29.656l-2.828,2.828l-14.14-14.14l2.828-2.828L32.484,29.656z"></path>
                  </svg>
                </button>
                <button class="editar" (click)="abrirModalEditar(producto.codigo)">‚úèÔ∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="pup-up" [ngClass]="{ 'oculto': modoOculto }">
      <div class="pop-up-container">
        <span class="cerrar" (click)="editarModoOcuto()">‚ùå</span>
        <app-editar-producto class="editar" [productosEditar]="productosEditar"
          (modoOculto)="editarModoOcuto()"></app-editar-producto>

      </div>
    </div>
  </div>

  <div class="modal" [ngClass]="{ show: modalAbierto }" (click)="cerrarModal()">
    <div class="modal-dialog modal-xl" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalles del Producto</h5>
          <button type="button" class="btn-close" (click)="cerrarModal()"></button>
        </div>
        @if(productoSeleccionado){
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="codigo" class="form-label"><strong>C√≥digo</strong></label>
              <input type="text" id="codigo" class="form-control" [(ngModel)]="productoSeleccionado.codigo" readonly />
            </div>
            <div class="col-md-6">
              <label for="nombre" class="form-label"><strong>Nombre</strong></label>
              <input type="text" id="nombre" class="form-control" [(ngModel)]="productoSeleccionado.nombre" readonly />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="impuesto" class="form-label"><strong>Tipo impuesto</strong></label>
              <input type="text" id="impuesto" class="form-control" [(ngModel)]="productoSeleccionado.impuesto"
                readonly />
            </div>
            <div class="col-md-6">
              <label for="fechaCreacion" class="form-label"><strong>Fecha de Creaci√≥n</strong></label>
              <input type="text" id="fechaCreacion" class="form-control"
                [(ngModel)]="productoSeleccionado.fechaCreacion" readonly />
            </div>
          </div>
          <h6 class="mt-4">Formas de Venta</h6>
          <div *ngIf="productoSeleccionado?.formaVentas; else sinDatos">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Precio de compra</th>
                  <th>Precio de venta</th>
                  <th>Cantidad</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let forma of productoSeleccionado?.formaVentas">
                  <td>
                    <input type="text" class="form-control" [(ngModel)]="forma.nombre" readonly />
                  </td>
                  <td>
                    <input type="text" class="form-control"
                      [value]="forma.precioCompra | currency:'USD':'symbol':'1.0-0' " readonly />
                  </td>
                  <td>
                    <input type="text" class="form-control"
                      [value]="forma.precioVenta | currency:'USD':'symbol':'1.0-0'" readonly />
                  </td>
                  <td>
                    <input type="text" class="form-control" [value]="forma.cantidad" readonly />
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="d-flex justify-content-center">
              <button class="btn btn-light" (click)="abrirModalEditar(productoSeleccionado.codigo)"
                (click)="cerrarModal()">‚úèÔ∏è Editar producto</button>
            </div>
          </div>
          <ng-template #sinDatos>
            <p class="text-muted">No hay formas de venta disponibles.</p>
          </ng-template>
        </div>
        }
      </div>
    </div>
  </div>



















  <form [formGroup]="actualizarProductoForm" (ngSubmit)="actualizarProducto()">
    <div class="modal" [ngClass]="{ show: modalAbiertoEditar }" (click)="cerrarModalEditar()">
      <div class="modal-dialog modal-xl" (click)="$event.stopPropagation()">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">‚úèÔ∏è Editar Detalles del Producto</h5>
            <button type="button" class="btn-close" (click)="cerrarModalEditar()"></button>
          </div>
          @if(productoSeleccionado){
          <div class="modal-body">
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="codigo" class="form-label"><strong>C√≥digo</strong></label>
                <input type="text" id="codigo" class="form-control" formControlName="codigo" [(ngModel)]="productoSeleccionado.codigo"
                  readonly />
              </div>
              <div class="col-md-6">
                <label for="nombre" class="form-label"><strong>Nombre</strong></label>
                <input type="text" id="nombre" class="form-control" formControlName="nombre" [(ngModel)]="productoSeleccionado.nombre" />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="impuesto" class="form-label"><strong>Tipo de impuesto</strong></label>
                <select id="impuesto" class="form-control" formControlName="impuesto" [(ngModel)]="productoSeleccionado.impuesto">
                  <option [value]="true">IVA</option>
                  <option [value]="false">Excento de IVA</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="fechaCreacion" class="form-label"><strong>Fecha de Creaci√≥n</strong></label>
                <input type="text" id="fechaCreacion" class="form-control" formControlName="fechaCreacion"
                  [(ngModel)]="productoSeleccionado.fechaCreacion" readonly />
              </div>
            </div>
            <h6 class="mt-4">Formas de Venta</h6>
            <div *ngIf="productoSeleccionado?.formaVentas; else sinDatos">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Precio de compra</th>
                    <th>Precio de venta</th>
                    <th>Cantidad</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let forma of productoSeleccionado?.formaVentas">
                    <td>
                      <input type="text" class="form-control" [(ngModel)]="forma.nombre" />
                    </td>
                    <td>
                      <input type="number" class="form-control" [(ngModel)]="forma.precioCompra"
                        [value]="forma.precioCompra" />
                    </td>
                    <td>
                      <input type="number" class="form-control" [(ngModel)]="forma.precioVenta"
                        [value]="forma.precioVenta" />
                    </td>
                    <td>
                      <input type="number" class="form-control" [(ngModel)]="forma.cantidad" [value]="forma.cantidad" />
                    </td>
                  </tr>
                </tbody>
              </table>

              <div class="conatiner">
                <div class="row">
                  <div class="col-md-2">
                    <div class="d-flex justify-content-left">
                      <button class="btn btn-light" (click)="abrirModal(productoSeleccionado.codigo)"
                        (click)="cerrarModalEditar()">Ver detalles</button>
                    </div>
                  </div>
                  <div class="col-md-8">
                    <div class="d-flex justify-content-center">
                      <button class="btn btn-primary" (click)="actualizarProducto()">Actualizar Producto</button>
                    </div>
                  </div>
                  <div class="col-md-2">
                  </div>
                </div>
              </div>
            </div>

            <ng-template #sinDatos>
              <p class="text-muted">No hay formas de venta disponibles.</p>
            </ng-template>
          </div>
          }
        </div>
      </div> 
    </div>
  </form>














  <div class="d-flex justify-content-center align-items-center mt-3 flex-wrap" *ngIf="modoOculto">
    <nav aria-label="Page navigation" class="w-100">
      <ul class="pagination justify-content-center mt-3 flex-wrap">
        <!-- P√°gina anterior -->
        <li class="page-item" [class.disabled]="paginaActual === 0">
          <button class="page-link" (click)="paginaAnterior()" tabindex="-1" aria-disabled="true">
            Anterior
          </button>
        </li>

        <!-- Mostrar las p√°ginas -->
        <li class="page-item" *ngFor="let page of paginas; let i = index" [class.active]="paginaActual === i">
          <button class="page-link" (click)="irPagina(i)">{{ i + 1 }}</button>
        </li>

        <!-- P√°gina siguiente -->
        <li class="page-item" [class.disabled]="paginaActual === totalPaginas - 1">
          <button class="page-link" (click)="paginaSiguiente()">Siguiente</button>
        </li>
      </ul>
    </nav>
  </div>